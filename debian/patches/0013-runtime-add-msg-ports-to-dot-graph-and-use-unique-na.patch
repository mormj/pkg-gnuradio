From 1b49dce6f6163f61471a789ad88e49a5e8ebc100 Mon Sep 17 00:00:00 2001
From: Bastian Bloessl <mail@bastibl.net>
Date: Wed, 14 Aug 2019 13:33:57 +0200
Subject: [PATCH 13/14] runtime: add msg ports to dot graph and use unique
 names

---
 gnuradio-runtime/lib/flowgraph.cc | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/gnuradio-runtime/lib/flowgraph.cc b/gnuradio-runtime/lib/flowgraph.cc
index 435611f599..96956b1f0d 100644
--- a/gnuradio-runtime/lib/flowgraph.cc
+++ b/gnuradio-runtime/lib/flowgraph.cc
@@ -491,6 +491,7 @@ std::string dot_graph_fg(flowgraph_sptr fg)
 {
     basic_block_vector_t blocks = fg->calc_used_blocks();
     edge_vector_t edges = fg->edges();
+    msg_edge_vector_t msg_edges = fg->msg_edges();
 
     std::stringstream out;
 
@@ -498,7 +499,7 @@ std::string dot_graph_fg(flowgraph_sptr fg)
 
     // Define nodes and set labels
     for (basic_block_viter_t block = blocks.begin(); block != blocks.end(); ++block) {
-        out << (*block)->unique_id() << " [ label=\"" << (*block)->name() << "\" ]"
+        out << (*block)->unique_id() << " [ label=\"" << (*block)->alias() << "\" ]"
             << std::endl;
     }
 
@@ -508,6 +509,11 @@ std::string dot_graph_fg(flowgraph_sptr fg)
             << edge->dst().block()->unique_id() << std::endl;
     }
 
+    for (msg_edge_viter_t edge = msg_edges.begin(); edge != msg_edges.end(); edge++) {
+        out << edge->src().block()->unique_id() << " -> "
+            << edge->dst().block()->unique_id() << " [color=blue]" << std::endl;
+    }
+
     out << "}" << std::endl;
 
     return out.str();
-- 
2.20.1

